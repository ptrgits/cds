---
description: Information useful when generating Figma Code Connect files for new components.
globs:
alwaysApply: false
---

# Figma Code Connect Generation Rules

When creating a new component in the CDS design system, you MUST also create corresponding Figma Code Connect files to enable proper integration with Figma Dev Mode.

## File Structure Requirements

For every new component created, generate Code Connect files following this structure:

### Web Components

- Location: `packages/web/src/[category]/__figma__/[ComponentName].figma.tsx`
- Example: `packages/web/src/buttons/__figma__/NewButton.figma.tsx`

### Mobile Components

- Location: `packages/mobile/src/[category]/__figma__/[ComponentName].figma.tsx`
- Example: `packages/mobile/src/buttons/__figma__/NewButton.figma.tsx`

### Visualization Components

- Web: `packages/web-visualization/src/[category]/__figma__/[ComponentName].figma.tsx`
- Mobile: `packages/mobile-visualization/src/[category]/__figma__/[ComponentName].figma.tsx`

## Code Connect File Template

Use this template for all new Code Connect files:

```tsx
import { figma } from '@figma/code-connect';
// Add React import for mobile components only
// import React from 'react';

import { ComponentName } from '../ComponentName';

figma.connect(
  ComponentName,
  'https://www.figma.com/design/k5CtyJccNQUGMI5bI4lJ2g/✨-CDS-Components?node-id=REPLACE_WITH_ACTUAL_NODE_ID&m=dev',
  {
    imports: ["import { ComponentName } from '@coinbase/cds-PLATFORM/CATEGORY/ComponentName';"],
    props: {
      // Map Figma properties to component props
      // Use figma.enum() for dropdown/variant properties
      // Use figma.boolean() for boolean properties
      // Use figma.string() for text properties
      // Use figma.instance() for nested components/icons
      // Use figma.nestedProps() for complex nested properties

      // Example mappings:
      variant: figma.enum('variant', {
        primary: 'primary',
        secondary: 'secondary',
        // Add all variant options
      }),
      disabled: figma.boolean('disabled'),
      size: figma.enum('size', {
        small: 's',
        medium: 'm',
        large: 'l',
      }),
      // Add more prop mappings as needed
    },
    example: (props) => <ComponentName {...props}>Component Content</ComponentName>,
  },
);
```

## Platform-Specific Rules

### Web Components

- Import path format: `@coinbase/cds-web/[category]/[ComponentName]`
- NO React import needed (already available globally)
- Use web-specific prop names and values

### Mobile Components

- Import path format: `@coinbase/cds-mobile/[category]/[ComponentName]`
- MUST include `import React from 'react';` at the top
- Use mobile-specific prop names and values
- Consider React Native specific properties

## Property Mapping Guidelines

### figma.enum() - For dropdowns/variants

```tsx
variant: figma.enum('variant', {
  'Figma Display Name': 'codeValue',
  'Primary': 'primary',
  'Secondary': 'secondary',
}),
```

### figma.boolean() - For boolean properties

```tsx
disabled: figma.boolean('disabled'),
loading: figma.boolean('loading'),
```

### figma.boolean() with custom values - For conditional properties

```tsx
startIcon: figma.boolean('show startIcon', {
  true: figma.instance('↳ start icon'),
  false: undefined,
}),
```

### figma.string() - For text content

```tsx
label: figma.boolean('show label', {
  true: figma.string('↳ label string'),
  false: undefined,
}),
```

### figma.instance() - For nested components/icons

```tsx
icon: figma.instance('↳ icon'),
```

### figma.nestedProps() - For complex nested properties

```tsx
placeholder: figma.nestedProps('string.text input', {
  text: figma.enum('Ready-made', {
    Custom: figma.string('string'),
    Email: figma.textContent('text-input-label'),
  }),
}),
```

## Multi-Variant Support

For components with multiple variants in Figma, create separate figma.connect() calls:

```tsx
// Default variant
figma.connect(ComponentName, 'figma-url', {
  /* props */
});

// Specific variant
figma.connect(ComponentName, 'figma-url', {
  variant: { 'show suffix': true },
  props: {
    /* variant-specific props */
  },
  example: (props) => <ComponentName {...props} />,
});
```

## Required Steps After Creation

1. **Get Figma Node ID**: Contact the design team to get the correct node-id from the Figma component
2. **Update the figma.connect() URL**: Replace `REPLACE_WITH_ACTUAL_NODE_ID` with the actual node ID
3. **Test the mapping**: Run `npx figma connect validate` to ensure the connection works
4. **Publish when ready**: Use `npx figma connect publish --token $FIGMA_CODE_CONNECT_TOKEN`

## Common Categories

Use these standard categories for organizing components:

- `buttons` - Button, IconButton, etc.
- `controls` - TextInput, Select, etc.
- `cards` - Card components
- `overlays` - Modal, Toast, Alert, etc.
- `layout` - Stack, Grid, Divider, etc.
- `typography` - Text, Heading, etc.
- `media` - Icon, Image, Avatar, etc.
- `navigation` - Tabs, Breadcrumb, etc.
- `dates` - DatePicker, Calendar, etc.

## Validation Requirements

Before considering the Code Connect file complete:

- [ ] Correct import path for the platform (web/mobile)
- [ ] All component props are mapped to Figma properties
- [ ] Example usage matches component API
- [ ] File is in correct `__figma__` directory
- [ ] File follows naming convention: `[ComponentName].figma.tsx`
- [ ] Figma URL contains actual node-id (not placeholder)

## Error Prevention

- Always use the correct base Figma URL: `https://www.figma.com/design/k5CtyJccNQUGMI5bI4lJ2g/✨-CDS-Components`
- Ensure import paths match the package.json exports
- Use consistent naming between component file and figma file
- Include React import only for mobile components
- Map all essential component props to avoid incomplete examples

## Integration with Development Workflow

When creating a new component:

1. Create the main component file
2. Create the Code Connect file using this template
3. Create tests and stories as usual
4. Coordinate with design team for Figma node ID
5. Validate and publish Code Connect file
6. Update component documentation to reference Figma integration

This ensures every new component has proper design-development integration from day one.
